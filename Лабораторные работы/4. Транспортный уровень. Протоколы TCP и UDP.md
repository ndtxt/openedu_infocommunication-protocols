# Протоколы TCP и UDP

1. Сетевые интерфейсы
2. Настройка интерфейсов
3. Запуск утилиты nc. UDP-сервер
4. Передача данных по UDP. часть 2
5. Запуск утилиты nc. TCP-сервер
6. Анализ TCP заголовка.Флаги
7. Анализ перехваченных пакетов


---


#### 1. Сетевые интерфейсы

> Наиболее распространёнными транспортными протоколами сети Интернет являются протоколы TCP(RFC 793) и UDP(RFC 768).

> Протокол TCP является протоколом с установлением соединения, а так же включает в себя механизмы восстановления потерянных данных, посредством их повторной передачи. TCP является транспортным протоколом, обеспечивающим гарантированную доставку информации. В отличии от него, более простой протокол UDP не имеет механизмов установления соединения и борьбы с потерями, не обеспечивает гарантированной доставки информации, но при этом создаёт меньшую нагрузку на сеть.

> С помощью утилиты `ifconfig` выведите информацию обо всех сетевых интерфейсах на IPServer. Узнайте IP адрес интерфейса eth1.

__`Ответ:`__
`10.2.1.6`


#### 2. Настройка интерфейсов

> UDP(User Datagram Protocol) — протокол пользовательских датаграмм, довольно быстрый протокол, поскольку в нем определен самый минимальный механизм, необходимый для передачи данных. Конечно, он имеет некоторые недостатки, например то, что сообщения поступают в хаотичном порядке, и то, которое отправлено первым, может быть получено последним. Доставка сообщений UDP не гарантируется, сообщение может потеряться, или могут быть получены две копии одного и того же сообщения. Последний случай возникает, если для отправки сообщений на один адрес использовалось два разных маршрута.

> Перед началом работы необходимо убедиться, что на рабочем месте и его маршрутизаторе корректно настроена адресация и маршрутизация к узлу предоставления услуг. Для этого необходимо на рабочем месте выполнить комнаду:

```
ping -c 4 10.2.1.6
```

> Если от сервера не было получено ни одного ответа, то необходимо выполнить следующие настройки на рабочем месте:

```
ifconfig

sudo ifconfig eth1 192.168.106.20 netmask 255.255.255.0 up 

ifconfig
ip route

sudo ip route add 10.2.1.0/24 via 192.168.106.1

ip route
```

> на маршрутизаторе Mikrotik:

```
/ip address print
/ip address add interface=ether2 address=192.168.106.1 netmask=255.255.255.0

/ip address print
/ip route print

/ip route add dst-address=10.2.1.0/24 gateway=10.2.1.254

/ip route prin
```


#### 3. Запуск утилиты nc. UDP-сервер

> Утилита `nc` (или `netcat`) используется практически для всего, что касается TCP или UDP. Например, открытие TCP соединений, посылка UDP пакетов, прослушивание TCP и UDP портов, сканирование портов.

> После того как будет установлено соединение, netcat не волнует, какая из сторон будет использоваться, как server, а какая, как client. Всё, что будет набрано на второй консоли, будет отображено на первой и наоборот.

> Запустить через консоль IP-server'а утилиту nc (netcat), при помощи команды `nc -u -l -p <номер прослушиваемого порта>`

> В данном задании необходимо прослушать порт номер 10000. Опция -u - использовать протокол UDP, взамен используемого по-умолчанию TCP. Опция -l - слушать входящие соединения, вместо подключения к удалённому хосту. Опция -p - служит для указания номера порта.

> на сервере
```
ifconfig
nc -u -l -p 10000

```

> на клиенте

```
nc -u 10000
Привет, сервер!
```
> Выпишите в ответ параметры для ПЕРВОГО перехваченного UDP-пакета(с портом 10000):

> Номер кадра (frame)

__`Ответ:`__
`1`

> IP-адрес сервера

__`Ответ:`__
`10.2.1.6`

> Порт отправителя

__`Ответ:`__
`52223`

> Порт получателя

__`Ответ:`__
`10000`

> Значение поля протокол заголовка IP

__`Ответ:`__
`17`


#### 4. Передача данных по UDP. часть 2

> Протокол обмена управляющими сообщениями ICMP (Internet Control Message Protocol) позволяет маршрутизатору сообщить оконечному узлу-отправителю об ошибках, с которыми машрутизатор столкнулся при передаче какого-либо IP-пакета от этого узла.

> Следует иметь в виду, что протокол ICMP - это протокол сообщений об ошибках, а не протокол коррекции ошибок. Оконечный узел-отправитель, проанализировав сообщение ICMP протокола, может предпринять некоторые действия для того, чтобы ошибка больше не повторялась, но самим протоколом ICMP никакие действия или рекомендации по устранению ошибок не регламентируются.

> Существует несколько типов сообщений ICMP. Каждый тип сообщения имеет свой формат, при этом все они начинаются с общих трех полей: 8-битного целого числа, обозначающего тип сообщения (TYPE), 8-битного поля кода (CODE), которое конкретизирует назначение сообщения, и 16-битного поля контрольной суммы (CHECKSUM). Кроме того, сообщение ICMP всегда содержит заголовок и первые 64 бита данных пакета IP, который вызвал ошибку. Это делается для того, чтобы узел-отправитель смог более точно проанализировать причину ошибки, так как все протоколы прикладного уровня стека TCP/IP содержат наиболее важную информацию для анализа в первых 64 битах своих сообщений.

> на клиенте
```
nc -u 10.2.1.6 10000
Сервер, привет!
```
> текст, пакет никуда не дойдет

> Введите название протокола, который используется для возврата информации об ошибке

__`Ответ:`__
`ICMP`

> Выпишите тип ошибки(в числовом формате)

__`Ответ:`__
`3`


#### 5. Запуск утилиты nc. TCP-сервер

> Утилита netcat, по умолчанию, использует протокол TCP. Утилита netcat создает TCP-соединения, с помощью которых можно передавать практически любой вид информации, т.е. не только сообщения набранные пользователем с клавиатуры, а любые указанные файлы. Таким образом, утилита netcat может использоваться, как программа передачи файлов.

> Протокол TCP (Transmission Control Protocol) обеспечивает надежную транспортировку данных между прикладными процессами путем установления логического соединения между ними. Информация, поступающая к протоколу TCP от протоколов более высокого уровня, рассматривается протоколом TCP как неструктурированный поток байтов. Поступающие данные буферизируются средствами TCP. Для передачи на сетевой уровень из буфера «вырезается» некоторая непрерывная часть данных, которая называется сегментом. Сегмент состоит из фиксированного 20-байтного заголовка (плюс необязательная часть), за которой могут следовать байты данных.

> Запустить через консоль IP-server'а утилиту nc (netcat), при помощи команды

> В данном задании необходимо прослушать порт номер 10100. Опция -l - позволяет слушать входящие соединения, вместо подключения к удалённому хосту. Опция -p - служит для указания номера порта.

> Номер кадра(frame):

__`Ответ:`__
`1`

> IP-адрес сервера:

__`Ответ:`__
`10.2.1.6`

> Порт отправителя:

__`Ответ:`__
`36390`

> Порт получателя:

__`Ответ:`__
`10100`

> Значение поля "Протокол"(в числовом формате) заголовка IP:

__`Ответ:`__
`6`


#### 6. Анализ TCP заголовка.Флаги

> В TCP-заголовке существуют флаги - это однобитные поля, каждое из которых имеет своё значение.

> Флаг `URG` - бит, установленное в 1 значение которого означает, что TCP-пакет содержит важные (urgent) данные.

> Флаг `ACK` - бит, установленное в 1 значение которого означает, что TCP-пакет содержит в поле "номер подтверждения" верные данные.

> Флаг `PSH` - бит, установленное в 1 значение которого означает, что данные содержащиеся в TCP-пакете должны быть немедленно переданы прикладной программе, для которой они адресованы. Подтверждение для TCP-пакета, содержащего единичное значение во флаге PSH, означает, что и все предыдущие TCP-пакеты достигли адресата.

> Флаг `RST` - бит, устанавливаемый в 1 в TCP-пакете, отправляемом в ответ на получение неверного TCP-пакета. Также может означать запрос на переустановление логического соединения.

> Флаг `SYN` - бит, установленное в 1 значение которого означает, что TCP-пакет представляет собой запрос на установление логического соединения. Получение пакета с установленым флагом SYN должно быть подтверждено принимающей стороной.

> Флаг `FIN` - бит, установленное в 1 значение которого означает, что TCP-пакет представляет собой запрос на закрытие логического соединения и является признаком конца потока данных, передаваемых в этом направлении. Получение пакета с установленым флагом FIN должно быть подтверждено принимающей стороной.

> Флаг протокола TCP использующийся при установлении соединения:

__`Ответ:`__
`SYN`

> Флаг протокола TCP использующийся при передаче данных:

__`Ответ:`__
`PSH`

> Флаг протокола TCP использующийся при разрыве соединения:

__`Ответ:`__
`FIN`


#### 7. Анализ перехваченных пакетов

> Каждое TCP-соединение (даже если оно не установлено полностью) занимает определенное количество ресурсов системы. Поэтому слишком большое число соединений может замедлить работу системы или привести к ее отказу. Чтобы этого избежать, следует корректно настроить таймеры сброса неиспользуемых соединений, а ошибочные соединения сбрасывать. В протоколе TCP для сброса соединения используется флаг `RST`.

> Введите номер первого кадра, уведомляющего об ошибке:

__`Ответ:`__
`4`

> Введите название протокола(в числовом формате), который используется для возврата информации об ошибке: 

__`Ответ:`__
`6`

> Выпишите значене флага, указывающего на наличие ошибки:

__`Ответ:`__
`1`


#### 

> 

__`Ответ:`__
``


#### 

> 

__`Ответ:`__
``
