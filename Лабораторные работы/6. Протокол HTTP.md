# Протоколы DHCP и DNS

1. Настройка интерфейсов
2. Создание каталога
3. Редактирование конфигурационных файлов часть1
4. Редактирование конфигурационных файлов часть2
5. Редактирование конфигурационных файлов на рабочем месте
6. Настройка HTTP-сервера Apache
7. Проверка настроек сервера Apache
8. Простой сценарий взаимодействия с HTTP-сервером
9. Анализ http-запроса
10. Анализ http-ответа
11. Запрос несуществующей страницы


---

#### 1. Настройка интерфейсов

> HTTP (HyperText Transfer Protocol, протокол передачи гипертекста) — протокол передачи данных (изначально — в виде гипертекстовых документов в формате HTML, в настоящий момент используется для передачи произвольных данных – обычный текст, гипертекст (HTML), таблицы стилей, клиентские сценарии, изображения, документы в различных форматах, бинарная информация и т. д.).

> На данный момент — это один из наиболее широко используемых прикладных протоколов.

```
ping -c 4 10.2.1.6
connect: Network is unreachable
sudo ifconfig eth1 192.168.106.20 netmask 255.255.255.0 up
sudo ip route add 10.2.1.0/24 via 192.168.106.1
```

> на маршрутизаторе рабочего места:

```
ip address add interface=ether2 address=192.168.106.1 netmask=255.255.255.0
ip route add dst-address=10.2.1.0/24 gateway=10.2.1.254
```


#### 2. Создание каталога

> World Wide Web или WWW – глобальная распределенная информационная система, в которой гипертекстовые документы и другие данные связаны посредством ссылок. В настоящее время, когда говорится об Интернете, - подразумевается именно, глобальная паутина.

> В 1990 году Тим Бернерс-Ли представил свой проект, который так и назывался WorldWideWeb. Это был первый веб-браузер, включавший в себя и редактор. Помимо самого веб-браузера были разработаны сервер, протокол взаимодействия HTTP, язык HTML, а также понятие уникального идентификатора ресурсов URI.

> Главной идеей новой технологии было создание системы хранения и распространения документов, где все документы связаны между собой посредством различных ссылок.

> Подключитесь к консоли сервера приложений, нажав на пиктограмму IPSrv. Запустите скрипт, для создания файлов, содержащих параметры работы DNS-сервера. Используя команду:

```
conf-dns.sh 6
```

> В консоли сервера приложений запустите скрипт, для создания файлов, содержащих параметры работы HTTP-сервера. Используя команду:

```
conf-http.sh 6
```

> Создайте каталог www.rm06.ip.lab в каталоге /var/www/ . Этот каталог будет содержать файлы относящиеся к создаваемому сайту. Для создания каталога используйте команду:

```
mkdir /var/www/www.rm06.ip.lab
```

> Проверьте, что каталог создан верно, используя команду:

```
ls /var/www/
```


#### 3. Редактирование конфигурационных файлов часть1 20

> Файл db.rm09.ip.lab содержит описание dns зоны. Это описание включает в себя SOA-информацию об авторизации записи, а так же параметры записей типа SOA. Затем содержится ресурсная запись, содержащая имя ресурса, тип записи и данные ресурсной записи.

> Тип записи A соответствует прямому преобразованию.

> Используя консоль IPServer'а, добавьте в конец файла /etc/bind/db.rm06.ip.lab строку:www.rm06.ip.lab. A 10.2.1.6

```
echo "www.rm06.ip.lab. A 10.2.1.6" >> /etc/bind/db.rm06.lab
cat /etc/bind/db.rm06.ip.lab
```


#### 4. Редактирование конфигурационных файлов часть2

> Файл db.1.2.10 содержит описание обратной зоны DNS. Обратный запрос имеет тип PTR.

> in-addr.arpa - доменное имя, указывающее на то, что совершается реверсивный запрос, т.е запрашиваются данные для какого-либо адреса.

> В данном случае ресурсная запись содержит относительное имя ресурса, зависящее от варианта, под которым выполняется работа.

> Используя консоль IPServer'а, добавьте в конец файла /etc/bind/db.1.2.10 строку:6 PTR www.rm06.ip.lab

```
echo "6 PTR www.rm06.ip.lab" >> /etc/bind/db.1.2.10
root@IPSrv06:~# cat /etc/bind/db.1.2.10
```


#### 5. Редактирование конфигурационных файлов на рабочем месте

> Сервис системы доменных имен строится по схеме "клиент-сервер". В качестве клиентской части выступает прикладной процесс, который запрашивает информацию о соответствии имени адресу (или наоборот адреса имени). Этот программный процесс и называют resolver.

> Главная задача resolver - принять запрос от прикладного программного обеспечения, обеспечить взаимоодействие с серверами DNS и вернуть в зависимости от запроса либо IP-адрес, либо доменное имя этому прикладному программному обеспечению.

> Используя консоль рабочего места, добавьте в файл /etc/resolv.conf строку:nameserver 10.2.1.6

```
echo "nameserver 10.2.1.6" | sudo tee /etc/resolv.conf
cat /etc/resolv.conf
```


#### 6. Настройка HTTP-сервера Apache

> Apache - это полнофункциональный, расширяемый веб-сервер, полностью поддерживающий протокол HTTP/1.1 и распространяющийся с открытым исходным кодом.

> Сервер может работать практически на всех распространенных платформах. При этом он очень прост в установке и конфигурации.

> Перезапустите DNS-сервер для того, чтобы новые настройки вступили в силу, выполните для этого следующую комнаду на Сервере:

```
/etc/init.d/bind9 restart
cat /etc/apache2/sites-available/www.rm06.ip.lab
```

__`Ответ:`__
`/var/www/www.rm06.ip.lab`


#### 7. Проверка настроек сервера Apache

> Apache разделяет свои функциональные возможности и компоненты на отдельные части, которые могут быть настроены и сконфигурированы независимо друг от друга. Базовая часть, которая отвечает за отдельный сайт или домен называется виртуальным хостом (virtual host). Эта система позволяет администратору использовать один сервер, чтобы раздавать несколько сайтов используя один интерфейс или IP.

> Для включения созданного виртуального хоста(сайта) используется утилита a2ensite.

> Отключается хост(сайт) аналогично утилитой a2dissite

> Запустите на IPServ сервер Apache2, используя команду:

```
service apache2 start
```

> Посмотрите содержимое каталога /etc/apache2/sites-enabled/, используйте для этого команду:

```
ls /etc/apache2/sites-enabled/
```

> Включите сайт и проверьте созданные настройки с помощью следующих команд:

```
a2ensite www.rm06.ip.lab
apache2ctl configtest
```

> Перезагрузите настройки сервера Apache, используя команду:

```
service apache2 reload
```

> Перезапустите сервер, используя команду:

```
service apache2 restart
```

> Посмотрите содержимое каталога /etc/apache2/sites-enabled/ ещё, чтобы убедиться что файл с необходимыми настройками добавился, используйте для этого команду:

```
ls /etc/apache2/sites-enabled/
```


#### 8. Простой сценарий взаимодействия с HTTP-сервером

> Curl - инструмент для переноса данных (файлов) с сервера или на сервер, используя один из поддерживаемых протоколов (DICT, FILE, FTP, FTPS, GOPHER, HTTP, HTTPS, IMAP, IMAPS, LDAP, LDAPS, POP3, POP3S, RTMP, RTSP, SCP, SFTP, SMTP, SMTPS, TELNET and TFTP).

> Синтаксис написания адреса URL зависит от используемого протокола. Подробное описание находится в RFC 3986.

> Отправьте c рабочего места запрос HTTP-серверу, запустив программу curl из консоли рабочего места:

```
curl www.rm06.ip.lab
```

> В консольном выводе команды определите html-заголовок и введите его в ответ:

__`Ответ:`__
`It works!`


#### 9. Анализ http-запроса

> Обмен сообщениями в ходе HTTP-соединения идёт по обыкновенной схеме «запрос-ответ».

> Каждое HTTP-сообщение состоит из трёх частей, которые передаются в указанном порядке:

> Стартовая строка - определяет тип сообщения;

> Заголовки - разная полезная информация, которая характеризует тело сообщения, параметры передачи и прочие сведения;

> Тело сообщения - это сгенерированный html-код, который браузер потом будет отображать. Обязательно должно отделяться от заголовков пустой строкой.

> Пример стартовой строки HTTP-запроса:

> Метод - название запроса, одно слово заглавными буквами;

> URI - определяет путь к запрашиваемому документу;

> Версия - название протокола, символ / и пара разделённых точкой арабских цифр. Например: HTTP/1.1


> Номер первого пакета HTTP-запроса:

__`Ответ:`__
`8`

>Какой транспортный протокол используется для передачи сообщений HTTP (ответ введите в числовом формате):

__`Ответ:`__
`6`

> IP-адрес HTTP-сервера:

__`Ответ:`__
`10.2.1.6`

> Номер порта HTTP-сервера:

__`Ответ:`__
`80`

> Тип запроса:

__`Ответ:`__
`GET`

> Версия протокола HTTP:

__`Ответ:`__
`HTTP/1.1`

> Информация о клиентском приложении:

__`Ответ:`__
`curl/7.35.0`

>Полный идентификатор запрашиваемой страницы:

__`Ответ:`__
`http://www.rm06.ip.lab/`


#### 10. Анализ http-ответа

> Пример стартовой строки HTTP-ответа:

> Версия - название протокола, символ / и пара разделённых точкой арабских цифр;

> Код состояния - три цифры. По коду состояния определяеться дальнейшее содержимое сообщения и поведение клиента;

> Пояснение - текстовое короткое пояснение к коду ответа для пользователя. Никак не влияет на сообщение и является не обязательным

> Проанализируйте перехваченные пакеты и введите номер первого пакета HTTP-ответа:

__`Ответ:`__
`10`

> Код состояния обработки http-запроса:

__`Ответ:`__
`200`

> Значение response phrase:

__`Ответ:`__
`OK`

> Информация о HTTP-сервере:

__`Ответ:`__
`Apache/2.2.22 (Debian)`

> Тип данных, переданных с сервера:

__`Ответ:`__
`text/html`

>

#### 11. Запрос несуществующей страницы

> 404 ошибка — это код, который отдает сайт в ответ на запрос любой несуществующей страницы.

> Неважно по какой причине страница не найдена — не было ее никогда или ее удалили — поисковик получает ошибку 404, что означает, что индексировать данный URL нельзя.

> Каждый «правильный» сайт должен иметь настроенную страницу для вывода этой ошибки.

> Номер пакета первого HTTP-запроса :

__`Ответ:`__
`8`

> Тип запроса:

__`Ответ:`__
`GET`

> Полный идентификатор запрашиваемой страницы:

__`Ответ:`__
`http://www.rm06.ip.lab/1.html`

> Номер первого пакета HTTP-ответа:

__`Ответ:`__
`10`

> Код состояния http-запроса:

__`Ответ:`__
`404`

> Значение response phrase:

__`Ответ:`__
`Not Found`
