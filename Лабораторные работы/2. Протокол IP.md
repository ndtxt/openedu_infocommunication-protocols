# Протокол IP
1. Подключение к узлу
2. Сетевые интерфейсы
3. Определение класса и маски для заданного IP-адреса
4. Настройка интерфейса на рабочем месте
5. Определение класса и маски маршрутизатора Mikrotik
6. Настройка интерфейса на маршрутизаторе Mikrotik
7. Проверка связи между устройствами
8. Расчет наибольшей маски
9. Применение маски
10. Передача данных
11. Фрагментация пакетов. Отправка длинного пакета.
12. Фрагментация пакетов. Прием пакетов.


---

#### 1. Подключение к узлу

> Определите имя узла (рабочего места)

__`Ответ:`__
`mikclient10`


#### 2. Сетевые интерфейсы

> Сетевые устройства соединены между собой каналами связи (Англ.link). Каждый сетевой интерфейс подключён к своему каналу связи. Если одно устройство соединено с несколькими другими сетевыми устройствами напрямую, то для связи с каждым из этих устройств необходимо иметь отдельный сетевой интерфейс.

> Конфигурирование сетевых интерфейсов устройства возможно при помощи команды ifconfig. Эта команда используется на этапе загрузки операционной системы при необходимости настройки интерфейсов. После этого данная команда используется только при отладке или настройке производительности системы. Если в команде ifconfig не заданы аргументы, то ifconfig выдает информацию о состоянии активных интерфейсов утсройства. Если в аргументах комнады указан только один интерфейс, выдается информация только о состоянии этого одного интерфейса; если указан один интерфейс, но с параметром -a, выдается информация о состоянии всех интерфейсов, даже отключенных. Иначе команда конфигурирует указанный интерфейс.

> Выведите информацию обо всех сетевых интерфейсах на рабочем месте с помощью команды:

```
ifconfig -a
```

> Определите MAC-адрес интерфейса eth0

__`Ответ:`__
`42:3a:51:22:12:63`


#### 3. Определение класса и маски для заданного IP-адреса

> Каждый сетевой интерфейс устройства имеет один MAC-адрес канального уровня и один или несколько IP-адресов, идентифицирующих интерфейс в глобальной сети.

> IP-адрес состоит из двух частей сетевой и машинной. Сетевая часть указывает на логическую сеть, а машинная на узел этой сети. Исторически IP-адреса группируются в классы и ранжируются по размеру устанавливаемых сетей. Для того, чтобы эффективно использовать адреса используют подсети, которые характеризуются маской.

> В общем случае IP-сети делятся на классы: А, В, С, D и Е. Принадлежность IP-адреса к тому или иному классу определяется значением первого октета, каждому классу соответствует, по-умолчанию, определенная маска.

> IP-адрес для вашего варианта: 192.168.188.8

> Определите класс сети, к которому относится адрес.

__`Ответ:`__
`C`

> Определите маску, соответствующую этому классу, запишите в виде десятичной сетевой маски

__`Ответ:`__
`255.255.255.0`

> Запишите суффикс соответствующий этой маске

__`Ответ:`__
`24`


#### 4. Настройка интерфейса на рабочем месте

> Клиентское рабочее место имеет два сетевых интерфейса. Со списком доступных сетевых интерфейсов можно ознакомиться командой ifconfig -a . Первый, как правило, eth0, используется для удаленного подключения администратора. Второй, как правило eth1, для внешнего подключения к сети Интернет. На модельном стенде подключение будет осуществляться через маршрутизатор доступа Mikrotik.

> Установите IP-адрес 192.168.188.8 на интерфейсе eth1 рабочего места с помощью утилиты ifconfig с правами привилегированного пользователя:

```
sudo ifconfig eth1 192.168.188.8
```


#### 5. Определение класса и маски маршрутизатора Mikrotik

> Адресация в IP-сетях первоначально была классовая, однако позднее стало ясно, что такое распределение является нерациональным и была введена бесклассовая адресация.

> Классовая IP адресация — это метод IP-адресации, который не позволяет рационально использовать ограниченный ресурс уникальных IP-адресов, т.к. не возможно использование различных масок подсетей. В классовом методе адресации используется фиксированная маска подсети, поэтому класс сети всегда можно идентифицировать по первым битам.

> Бесклассовая IP адресация (Classless Inter-Domain Routing — CIDR) — это метод IP-адресации, который позволяет рационально управлять пространством IP адресов. В бесклассовом методе адресации используются маски подсети переменной длины (variable length subnet mask — VLSM).

> Определите класс сети, к которому относится адрес 192.168.208.8.

__`Ответ:`__
`C`

> Определите маску, соответствующую этому классу, запишите в виде десятичной сетевой маски

__`Ответ:`__
`255.255.255.0`

> Запишите суффикс соответствующий этой маске

__`Ответ:`__
`24`


#### 6. Настройка интерфейса на маршрутизаторе Mikrotik

> Для работы маршрутизатора, необходимо произвести его базовую настройку, которая включает назначение IP-адресов на его интерфейсы.

> В подменю `/ip address` интерфейса командной строки маршрутизатора MikroTik (MiTk) задайте IP-адрес 192.168.208.8 на интерфейсе ether2 с помощью команды:

```
/ip address
print
add
192.168.2.2
ether2
print
```
> Проверьте правильность настройки адреса используя команду print в подменю /ip address


#### 7. Проверка связи между устройствами

> Существует несколько утилит для проверки связи между устройствами. Наиболее часто используется утилита ping, её можно применять как для проверки доступности отдельных компьютеров, так и сегментов сети. Большинство версий команды работает в бесконечном цикле, если не задан аргумент "число запросов" -c, определяющий количество пакетов, которые будут отправлены. Если вы хотите прервать выполнение ping, нажмите кнопку Abort(однако в большинстве консолей остановка выполняется сочетанием клавиш Ctrl+C).

> Информация о запрашиваемом адресате включает: размер пакета с заголовком для пересылки(по умолчанию 64 байта), запрашиваемый IP-адрес, порядковый номер ответного пакета и полное время прохождения пакета. Далее выводится статистика, в которой указано количество переданных пакетов и полученных, а так же процент потерянных пакетов. Если пришли не все пакеты или если разброс между максимальным и минимальным временем приема-передачи слишком большой, то это может быть признаком проблем с сетью. Допустимым значением потерь пакетов для сети передачи данных(за исключением интерактивного, сигнального и потокового трафика) является 0,1%.

> Подключитесь к Client Soho своего варианта и проверьте доступность настроенного интерфейса ether2 маршрутизатора Mikrotik:

```
ping -c 4 -I eth1 192.168.2.2
```
__`Ответ:`__
`100`


#### 8. Расчет наибольшей маски

> Зная маску подсети, сетевое устройство может определить границы подсети в которой находится и соответственно информацию о том, кто находится с ним в одной подсети, а кто — за ее пределами. Дело в том, что внутри одной сети компьютеры обмениваются пакетами напрямую, а при отправке пакета в другую сеть, отправляют их на маршрутизатор.

> Для рассчёта наибольшей маски,способной объединить адреса применяется следующий алгоритм: 
> 1. Заданные IP-адреса устройств необходимо перевести в двоичную систему, получив две последовательности из 32 бит каждая.
> 2. Над полученными 32-битными последовательностями произвести логическую операцию XOR (исключающее ИЛИ).
> 3. В полученном результате необходимо выделить непрерывную последовательность единиц, все биты, следующие за первым нулём необходимо заменить нулями.
> 4. Посчитайте количество непрерывно следующих единиц, это и есть префикс сети.
> 5. Если полученную двоичную последовательность разделить на 4 октета и перевести в десятичный вид, то таким образом вы получите десятичную запись маски подсети.

> Рассчитайте наибольшую возможную маску, при использовании которой будет возможна связь между маршрутизатором и рабочим местом для текущих адресов.

> https://otvet.mail.ru/question/56444513

```
192.168.0.2
192.168.2.2
255.255.252.0
```
__`Ответ:`__
`22`


#### 9. Применение маски

> По умолчанию на Linux-устройствах устанавливается классовая маска, если иное не задано пользователем. А на маршрутизаторе Mikrotik по умолчанию устанавливается маска /32. Однако такая маска может использоваться только для петлевых соединений или соединений типа точка-точка.

> В нашем случае маска устанавливаемая по-умолчанию не подходит и поэтому необходимо применить маску, позволяющую связать все требуемые устройства в одну подсеть.

> Для изменения маски на рабочем месте применяется команда(с правами привилегированного режима):

```
$ sudo ifconfig eth1 netmask 255.255.252.0
```

> Для изменения маски на маршрутизаторе применяется команда: set номер изменяемой записи в таблице IP-адресов netmask=255.255.252.0

```
/ip address
print
set 2 netmask=255.255.252.0
print
```

> Потерянных пакетов:

__`Ответ:`__
`0`


#### 10. Передача данных

> Maximum transmission unit (MTU) это максимальный объём данных, который может быть передан протоколом за одну итерацию. К примеру, Ethernet MTU равняется 1500 байт, что означает, что максимальный объём данных, переносимый Ethernet фреймом не может превышать 1500 байт (без учёта Ethernet заголовка и FCS(Frame Check Sequences)).

> Используя утилиту ifconfig, определите размер максимального блока пересылки (Maximum Transmission Unit, MTU) для интерфейса связи между рабочим местом и маршрутизатором.

> Выпишите размер MTU для интерфейса связи между рабочим местом и маршрутизатором

__`Ответ:`__
`1500`


#### 11. Фрагментация пакетов. Отправка длинного пакета.

> Tshark - это консольная утилита из состава Wireshark, предназначенная для захвата и анализа сетевых пакетов. С помощью этой утилиты можно выполнять захват пакетов в сети, сохранять пакеты в файле, просматривать ранее сохраненные файлы с информацией о сетевых пакетах.

> Канальный уровень сети обычно налагает ограни­чение на максимальный размер передаваемого кадра. Каждый раз, когда IP-модуль посылает дейтаграмму, он в процессе маршрутизации определяет, с какого интер­фейса она будет отправлена, и запрашивает значение MTU у этого интерфейса. Далее IP-модуль сравнивает MTU с размером дейтаграммы и, если MTU меньше дейтаграммы, то разбивает дейтаграмму на фрагменты. Фрагмен­тация может потребоваться как на машине-источнике исходной IP-дейтаграммы, так и на каких-либо промежуточных сетевых устройствах.

> Используя утилиту ping, отправьте с рабочего места запрос проверки связи размером 3500 байт (ключ -s позволяет указать размер запроса в байтах, ключ -с – количество генерируемых запросов):

```
ping -s 3500 -c 4 192.168.2.2
```

> где X.X.X.X – значение IP-адреса, настроенного на интерфейсе ether2 маршрутизатора Mikrotik.

> Проанализируйте перехваченные пакеты. Определите номера кадров, составляющих первый пакет ICMP-запроса: введите номера этих кадров, в порядке возрастания

__`Ответ:`__
`
1
2
3
`
> В первом кадре этого ICMP-пакета изучите IP-заголовок и выпишите идентификатор (в HEX-формате) данного пакета:

__`Ответ:`__
`0xee79`


#### 12. Фрагментация пакетов. Прием пакетов.

> IP протокол, при необходимости, осуществляет фрагментацию и дефрагментацию данных, передаваемых по сети. Если размер IP-пакета слишком велик для дальнейшей передачи по сети, то полученный пакет разбивается на несколько фрагментов, и каждый фрагмент оформляется в виде нового IP-пакета с теми же адресами отправителя и получателя. Фрагменты собираются в единое целое только в конечной точке своего путешествия. Если при дефрагментации пакета обнаруживается, что хотя бы один из фрагментов изначально передаваемого пакета был потерян или отброшен, то отбрасывается и весь пакет целиком.

> Проанализируйте перехваченные пакеты

> Определите максимальное количество полезных данных может передаваться в каждом пакете.

__`Ответ:`__
`?`
> не 1500 и не 1514 и не 65535, 1482, 1460, 1454

> Код

__`Ответ:`__
`0x0800`
